<div th:fragment="component-input-form-definition-x-datas" th:remove="tag">
  <template>
    <div>
      <template v-for="(_, index) in xDatas">
        <v-card>
          <v-row>
            <v-col cols="9">
              <v-card-subtitle>
                <v-text-field
                  @blur="save(index)"
                  v-model="xDatas[index].attributes.name"
                  :label="fields.label"
                  :hint="fields.hint"
                  :rules="[rules.requiredText, rules.noSpaces]"
                  class="required"
                >
                </v-text-field>
            </v-card-subtitle>
            </v-col>
            <v-col cols="3" class="d-flex align-center justify-center">
              <v-btn @click="remove(index)" icon class="spacer-2-icons-left">
                <v-icon color="red">mdi-delete-circle-outline</v-icon>
              </v-btn>
            </v-col>
          </v-row>
        </v-card>
      </template>

      <v-btn @click="add" class="my-5">Add x-data</v-btn>
    </div>
  </template>

  <script th:inline="javascript">
    DOM = document.getElementsByTagName("template")[0];
    DOM.remove();

    Vue.component("component-input-form-definition-x-datas", {
      template: DOM.innerHTML.toString(),

      props: { path: String, inputType: String },
      data() {
        return {
          xDatas: [],

          fields: {
            label: "X-data",
            hint: "",
          },
        };
      },
      mounted() {
        this.xDatas = this.elements;
      },
      watch: {
        elements() {
          this.xDatas = this.elements;
        },
      },
      methods: {
        save(index) {
          const path = `${this.path}elements`;
          const data = [...this.remainingElements, ...this.xDatas];

          this.$store.commit("updateJson", { path, data });
        },
        add() {
          this.xDatas.push({
            type: "element",
            name: "x-data",
            attributes: { name: "" },
          });
        },
        remove(index) {
          this.xDatas = this.xDatas.filter((_, idx) => idx !== index);
          this.save(index);
        },
      },
      computed: {
        json() {
          return this.$store.getters.jsonPath(this.path);
        },
        elements() {
          return this.json.elements.filter(
            (element) => element.name === "x-data"
          );
        },
        remainingElements() {
          return this.json.elements.filter(
            (element) => element.name !== "x-data"
          );
        },
        rules() {
          return this.$store.state.moduleRules.rules;
        },
      },
    });
  </script>
</div>
