<div th:fragment="component-field-set" th:remove="tag">
  <template>
    <v-card>
      <v-row>
        <v-col cols="10">
          <v-card-title>{{ inputLabel }}</v-card-title>
          <v-card-subtitle>
            <small>
              <a :href="docsUrl" target="_blank">{{ inputType }}</a>
            </small>
          </v-card-subtitle>
        </v-col>
        <v-col cols="2" class="d-flex align-center justify-center">
          <v-btn @click="showConfig = !showConfig" icon>
            <v-icon> mdi-circle-edit-outline </v-icon>
          </v-btn>
          <v-btn @click="removeSchema" icon>
            <v-icon color="red"> mdi-delete-circle-outline </v-icon>
          </v-btn>
        </v-col>
      </v-row>

      <transition name="fade">
        <v-card-text v-show="showConfig">
          <template
            v-if="Object.keys(map).length > 0"
            v-for="(element, index) in elements"
          >
            <component
              v-if="map[element.name] !== undefined"
              :is="map[element.name].componentName"
              v-bind="{ 
                path: depthPath(index),
                field: map[element.name].field,
                rules: map[element.name].rules,
                i18n: map[element.name].i18n
               }"
            ></component>
            <component
              v-else-if="element.name === 'items'"
              :is="'component-set-items'"
              v-bind="{ path: depthPath(index) }"
            ></component>
          </template>
        </v-card-text>
      </transition>
    </v-card>
  </template>

  <script th:inline="javascript">
    DOM = document.getElementsByTagName("template")[0];
    DOM.remove();

    Vue.component("component-field-set", {
      template: DOM.innerHTML.toString(),

      props: {
        path: String,
      },
      data() {
        return {
          showConfig: false,
          map: {},
        };
      },
      created() {
        this.map = app.$root._data.map;
      },
      methods: {
        depthPath(index) {
          return `${this.path}elements[${index}]`;
        },

        removeSchema() {
          app.$root.removeSchema(this.path);
        },
      },
      computed: {
        json() {
          return this.$store.getters.jsonPath(this.path);
        },
        inputLabel() {
          return _.get(this.json, "elements[0].elements[0].text") || "";
        },
        inputType() {
          return "Field_Set";
        },
        elements() {
          return this.json.elements || [];
        },
        docsUrl() {
          return `https://developer.enonic.com/docs/xp/stable/cms/schemas#${this.inputType.toLowerCase()}`;
        },
      },
    });
  </script>
</div>
