<div th:fragment="component-option-set" th:remove="tag">
  <template>
    <v-card>
      <div class="row pointer" @click="showConfig = !showConfig">
        <v-col cols="9">
          <v-card-title>{{ inputName }}</v-card-title>
          <v-card-subtitle>
            <small>
              <a :href="docsUrl" target="_blank" @click.stop>{{ inputType }}</a>
            </small>
          </v-card-subtitle>
        </v-col>
        <v-col cols="3" class="d-flex align-center justify-end">
          <v-btn
            @click.stop="moveSchema('up')"
            icon
            :disabled="ableToMoveSchema('up')"
          >
            <v-icon> mdi-arrow-up </v-icon>
          </v-btn>
          <v-btn
            @click.stop="moveSchema('down')"
            icon
            :disabled="ableToMoveSchema('down')"
          >
            <v-icon> mdi-arrow-down </v-icon>
          </v-btn>
          <v-btn @click.stop="removeSchema" icon>
            <v-icon color="red"> mdi-delete-circle-outline </v-icon>
          </v-btn>
        </v-col>
      </div>

      <transition name="fade">
        <v-card-text v-show="showConfig">

          <!-- Name -->
          <component
            :is="'component-input-fields-name'"
            v-bind="{ path, inputName}"
          ></component>

          <template v-for="(element, index) in elements">
            <component
              v-if="element.name !== 'input' && map[element.name] !== undefined"
              :is="map[element.name].componentName"
              v-bind="{ 
                path: depthPath(index),
                field: map[element.name].field,
                rules: map[element.name].rules,
                i18n: map[element.name].i18n
               }"
            ></component>
            <component
              v-else-if="element.name === 'options'"
              is="component-option-set-options"
              v-bind="{ path: depthPath(index), inputName }"
            ></component>
          </template>
        </v-card-text>
      </transition>
    </v-card>
  </template>

  <script th:inline="javascript">
    DOM = document.getElementsByTagName("template")[0];
    DOM.remove();

    Vue.component("component-option-set", {
      template: DOM.innerHTML.toString(),

      props: {
        path: String,
      },
      data() {
        return {
          showConfig: false,
          map: {},
        };
      },
      created() {
        this.map = app.$root._data.map;
      },
      methods: {
        depthPath(index) {
          return `${this.path}elements[${index}]`;
        },
        moveSchema(direction) {
          app.$root.moveSchema(this.path, direction);
        },
        ableToMoveSchema(direction) {
          return app.$root.ableToMoveSchema(this.path, direction);
        },
        removeSchema() {
          app.$root.removeSchema(this.path);
        },
      },
      computed: {
        json() {
          return this.$store.getters.jsonPath(this.path);
        },
        inputName() {
          return this.json.attributes.name;
        },
        inputType() {
          return "Option_Set";
        },
        elements() {
          return this.json.elements || [];
        },
        id() {
          return this.path + ":option_set";
        },
        docsUrl() {
          return `https://developer.enonic.com/docs/xp/stable/cms/schemas#${this.inputType.toLowerCase()}`;
        },
      },
    });
  </script>
</div>
